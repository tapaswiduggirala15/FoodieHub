<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Place Order - FoodieHub</title>
  <link rel="stylesheet" href="order.css" />
</head>

<body>
  <!-- Header -->
  <header>
    <h1>FoodieHub</h1>
    <nav>
      <ul>
        <li><a href="register.html">Register</a></li>
        <li><a href="login.html">Login</a></li>
        <li><a href="index.html">Home</a></li>
        <li><a href="menu.html">Menu</a></li>
        <li><a href="reservation.html">Reservation</a></li>
        <li><a href="order.html" class="active">Order</a></li>
        <li><a href="payment.html">Payment</a></li>
        <li><a href="contact.html">Contact</a></li>

      </ul>
    </nav>
  </header>

  <!-- Order Section -->
  <section class="order">
    <div class="order-content">
      <h2>Place Your Order</h2>
      <p>Review your selected items and confirm your order.</p>

      <form id="orderForm" class="order-form">
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" placeholder="Enter your name" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required><br><br>

        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required><br><br>

        <h3>Your Cart Items:</h3>
        <ul id="cartItems" style="list-style:none; padding:0; margin-bottom:10px;"></ul>

        <label for="address">Delivery Address:</label>
        <textarea id="address" name="address" placeholder="Enter delivery address" required></textarea><br><br>

        <button type="submit" class="btn">Place Order</button>
      </form>

      <p id="statusMessage" style="margin-top:10px; font-weight:bold;"></p>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 FoodieHub Project. All Rights Reserved.</p>
  </footer>

  <!-- ✅ Script -->
  <script>
    // Load cart from localStorage
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const cartList = document.getElementById("cartItems");

    if (cart.length === 0) {
      cartList.innerHTML = "<li style='color:red;'>Your cart is empty. Please add items from the menu.</li>";
    } else {
      cart.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${item.name} - $${item.price.toFixed(2)}`;
        cartList.appendChild(li);
      });
    }
    function addToCart(item) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart.push(item);
  localStorage.setItem("cart", JSON.stringify(cart));

  // ✅ Update total price
  const total = cart.reduce((sum, i) => sum + i.price, 0);
  localStorage.setItem("cartTotal", total);
}


    // Submit order
    document.getElementById("orderForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (cart.length === 0) {
        alert("Please add some items from the menu before placing an order!");
        return;
      }

      const formData = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        items: cart.map(item => item.name).join(", "),
        address: document.getElementById("address").value.trim()
      };

      const status = document.getElementById("statusMessage");
      status.textContent = "⏳ Sending your order...";

      try {
        const response = await fetch("https://foodiehub-backend-j0kb.onrender.com/api/orders", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          status.style.color = "green";
          status.textContent = "✅ Order placed successfully!";
          document.getElementById("orderForm").reset();
          localStorage.removeItem("cart"); // clear cart
          cartList.innerHTML = "<li style='color:green;'>Your order has been placed successfully!</li>";
        } else {
          status.style.color = "red";
          status.textContent = "❌ " + (result.message || "Failed to place order.");
        }
      } catch (error) {
        status.style.color = "red";
        status.textContent = " Failed to connect to the backend. Make sure server is running.";
      }
    });
  </script>
</body>
</html>